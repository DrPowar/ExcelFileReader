<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ExcelFileReader.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
        mc:Ignorable="d" Width="1400" Height="850" WindowStartupLocation="CenterScreen" CanResize="True"
        x:Class="ExcelFileReader.Views.MainWindow"
        xmlns:converters="clr-namespace:ExcelFileReader.InterfaceConverters;assembly=ExcelFileReader"
        xmlns:models="clr-namespace:ExcelFileReader.Models;assembly=ExcelFileReader"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="ExcelFileReader">

	<Window.Styles>
		<Style Selector="TextBlock">
			<Setter Property="FontFamily" Value="Arial"/>
			<Setter Property="FontSize" Value="18"/>
		</Style>
		<StyleInclude Source="avares://Avalonia.Controls.DataGrid/Themes/Fluent.xaml"/>

		<Style Selector="Button">
			<Setter Property="FontFamily" Value="Arial"/>
			<Setter Property="FontSize" Value="10"/>
		</Style>
	</Window.Styles>

	<Window.Resources>
		<converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
		<converters:DateOnlyConverter x:Key="DateOnlyConverter" />
		<models:Person x:Key="Person"/>
	</Window.Resources>

	<DockPanel Name="Root">
		<Grid>
			<StackPanel Width="270" DockPanel.Dock="Left" Background="Azure">
				<Button 
					IsEnabled="{Binding CanUploadFile}" 
					Command="{Binding GetAllDataFromDBButton_Click}"
					HorizontalAlignment="Center" 
					VerticalAlignment="Top"
					Width="250"
					Margin="0,20,0,20">
					
					<TextBlock HorizontalAlignment="Center">Get Data From DB</TextBlock>
				</Button>
				<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,0,0,20">
					<Button Width="120" IsEnabled="{Binding CanUploadFile}" Command="{Binding OpenFileButton_Click}" Margin="0,0,10,0">
						<TextBlock HorizontalAlignment="Center">Select File</TextBlock>
					</Button>
					<Button Width="120" IsEnabled="{Binding CanSaveData}" Command="{Binding SaveDataButton_Click}">
						<TextBlock HorizontalAlignment="Center">Save Data</TextBlock>
					</Button>
				</StackPanel>
				<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,0,0,20">
					<Button Width="120" IsEnabled="{Binding CanModifyDataBase}" Command="{Binding UpdateDataButton_Click}" Margin="0,0,10,0">
						<TextBlock HorizontalAlignment="Center">Update Data</TextBlock>
					</Button>
					<Button Width="120" IsEnabled="{Binding CanModifyDataBase}" Command="{Binding DeleteDataButton_Click}">
						<TextBlock HorizontalAlignment="Center">Delete Data</TextBlock>
					</Button>
				</StackPanel>
				
				<TextBlock HorizontalAlignment="Center" TextWrapping="Wrap" MaxWidth="250" FontSize="22" Text="{Binding ProgramStatus}"/>
			</StackPanel>
		</Grid>


		<Grid DockPanel.Dock="Right" Background="DarkSlateGray">
			
			<Grid.RowDefinitions>
				<RowDefinition Height="*"/>
				<RowDefinition Height="Auto"/>
			</Grid.RowDefinitions>

			<Grid 
				Width="450" 
				HorizontalAlignment="Center" 
				VerticalAlignment="Top" 
				Margin="7">

				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="450"/>
					<ColumnDefinition Width="100"/>
				</Grid.ColumnDefinitions>
				
				<TextBox Grid.Column="0" Text="{Binding SearchField}"></TextBox>
				<Border Grid.Column="1"
						Width="35"
						Height="35"
						Background="Gray"
						CornerRadius="5">
					<Button
							Width="35"
							Height="35"
							Background="Snow"
							Command="{Binding SearchDataCommand}"
							CommandParameter="{Binding SearchField}">
						<Image Source="/Assets/3844432_magnifier_search_zoom_icon.png"/>
					</Button>
				</Border>
			</Grid>
			
			<DataGrid
					  Name="PersonsGrid"
					  Margin="10, 50, 10, 10"
					  ItemsSource="{Binding People}"
					  IsReadOnly="False"
					  CanUserSortColumns="True"
					  GridLinesVisibility="All"
					  CanUserResizeColumns="True" 
					  BorderThickness="1"
					  BorderBrush="Black"
					  Background="Snow"
					  LoadingRow="RowsDataGrid_LoadingRow"
					  RowEditEnded="RowDataGrid_EditingRow"
					  VerticalAlignment="Stretch"
					  HorizontalAlignment="Stretch"
					  SelectionChanged="OnSelectionChanged">
				

				<DataGrid.Columns>
					<DataGridTextColumn Header="Id" Binding="{Binding Id}" IsReadOnly="True" />
					<DataGridTextColumn Header="First Name" Binding="{Binding FirstName}"/>
					<DataGridTextColumn Header="Last Name" Binding="{Binding LastName}" />
					<DataGridTemplateColumn Header="Gender">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<ComboBox SelectedItem="{Binding Gender}"
										  ItemsSource="{Binding #Root.((vm:MainWindowViewModel)DataContext).GenderOptions}"
										  BorderThickness="0"
										  HorizontalAlignment="Center"
										  Background="Transparent"
										  CornerRadius="0"
										  Loaded="GenderComboBox_Loaded"
										  Width="120"
										  SelectionChanged="RowDataGrid_EditingGender">
								</ComboBox>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTextColumn Header="Country" Binding="{Binding Country}"/>
					<DataGridTextColumn Header="Age" Binding="{Binding Age}"/>
					<DataGridTemplateColumn Header="Birthday">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<DatePicker SelectedDate="{Binding Birthday, Converter={StaticResource DateOnlyConverter}}"
											BorderThickness="0"
											HorizontalAlignment="Center"
											Background="Transparent"
											CornerRadius="0"
											FontSize="18"
											Loaded="DatePicker_Loaded"
											SelectedDateChanged="RowDataGrid_EditingDateTime"
											/>
								
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>

				</DataGrid.Columns>
			</DataGrid>

			<Border Grid.Row="1" Margin="0,10,0,20" HorizontalAlignment="Center"
				Background="Snow" CornerRadius="10">
			
			<StackPanel Orientation="Horizontal">
				<Button Command="{Binding FirstPageCommand}"
						Margin="10,10,0,10">
					&lt;
					&lt;
				</Button>
				<RepeatButton Margin="12,0,0,0"
							  Command="{Binding PreviousPageCommand}">
					&lt;
				</RepeatButton>
				<TextBlock Margin="8,0" VerticalAlignment="Center">
					<TextBlock.Text>
						<MultiBinding StringFormat="Page {0} of {1}">
							<Binding Path="CurrentPage" />
							<Binding Path="TotalPages" />
						</MultiBinding>
					</TextBlock.Text>
				</TextBlock>
				<RepeatButton Command="{Binding NextPageCommand}">
					&gt;
				</RepeatButton>
				<Button Margin="12,10,10,10"
						Command="{Binding LastPageCommand}">
					&gt;
					&gt;
				</Button>
			</StackPanel>
			</Border>

			<Grid Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Center">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>

				<Border
					Grid.Column="0"
					Margin="0,10,15,20"
					Background="Snow"
					CornerRadius="5">
					<TextBlock Margin="5"
							   Text="{Binding TotalItems, StringFormat={}{0} items}"
							   FontSize="16"/>
				</Border>

				<Border
					Grid.Column="1"
					Margin="0,10,15,20"
					Background="Snow"
					CornerRadius="5">
					<TextBlock Margin="5"
							   Text="{Binding ValidItems, StringFormat={}{0} valid items}"
							   Foreground="#49c46e"
							   FontSize="16"/>
				</Border>

				<Border
					Grid.Column="2"
					Margin="0,10,15,20"
					Background="Snow"
					CornerRadius="5">
					<TextBlock Margin="5"
							   Text="{Binding InValidItems, StringFormat={}{0} invalid items}"
							   Foreground="#ff8a8a"
							   FontSize="16"/>
				</Border>
			</Grid>


		</Grid>

	</DockPanel>

</Window>
